generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ─────────────────────────────────────────────
//   EVENT MODEL
// ─────────────────────────────────────────────
//

model Event {
  id        String   @id @default(cuid())
  title     String
  date      DateTime
  venue     String

  adultLoungePrice    Int
  adultStandardPrice  Int
  childLoungePrice    Int
  childStandardPrice  Int

  createdAt DateTime @default(now())
  orders    Order[]

  @@index([date])
}

//
// ─────────────────────────────────────────────
//   ORDER MODEL
// ─────────────────────────────────────────────
//

model Order {
  id        String   @id @default(cuid())
  eventId   String

  adultLounge   Int @default(0)
  adultStandard Int @default(0)
  childLounge   Int @default(0)
  childStandard Int @default(0)

  totalAmount  Int
  serviceFee   Int? @default(0)

  paid        Boolean  @default(false)
  status      String   @default("pending")

  createdAt   DateTime @default(now())

  email       String
  contactNo   String?
  name        String?

  paymentMethod String?
  ticketSent    Boolean @default(false)

  receiptUrl    String?
  receiptNote   String?

  event       Event    @relation(fields: [eventId], references: [id])
  tickets     Ticket[]

  @@index([eventId])
  @@index([email])
  @@index([contactNo])
  @@index([createdAt])
  @@index([eventId, contactNo])
}

//
// ─────────────────────────────────────────────
//   TICKET MODEL
// ─────────────────────────────────────────────
//

model Ticket {
  id        String   @id @default(cuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id])

  category  TicketCategory
  tier      TicketTier

  ticketCode String? @unique
  qrCode     String

  usedAt    DateTime?
  createdAt DateTime @default(now())

  @@index([orderId])
  @@index([category])
  @@index([tier])
  @@index([usedAt])
}

enum TicketCategory {
  ADULT
  CHILD
}

enum TicketTier {
  LOUNGE
  STANDARD
}

//
// ─────────────────────────────────────────────
//   USER MODEL (SAFE ROLE UPDATE)
// ─────────────────────────────────────────────
//

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String?
  role      UserRole  @default(ADMIN)
  createdAt DateTime  @default(now())
}

enum UserRole {
  ADMIN
  STAFF
  AUDIT
}
